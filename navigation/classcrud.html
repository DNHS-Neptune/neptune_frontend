---
layout: post
title: Classes
permalink: /classcrud/
menu: nav/home.html
search_exclude: true
show_reading_time: false
---

<style>
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: left;
    }
    th {
        background-color: #f4f4f4;
    }
    input {
        padding: 5px;
        margin-right: 10px;
    }
    .btn {
        padding: 5px 10px;
        cursor: pointer;
        border: none;
        color: white;
        border-radius: 5px;
    }
    .btn-add { background-color: #4CAF50; }
    .btn-update { background-color: #f0ad4e; }
    .btn-delete { background-color: #d9534f; }
</style>

<h2>Manage Classes</h2>

<input type="text" id="pickInput" placeholder="Enter class pick">
<button class="btn btn-add" onclick="createClass()">Add Class</button>

<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Pick</th>
            <th>User</th>
            <th>Update</th>
            <th>Delete</th>
        </tr>
    </thead>
    <tbody id="classBody"></tbody>
</table>

<script>
    var pythonURI = location.hostname.includes("localhost") || location.hostname === "127.0.0.1" 
        ? "http://127.0.0.1:8204" 
        : "https://neptune.stu.nighthawkcodingsociety.com";

    const fetchOptions = {
        method: "GET", 
        mode: "cors", 
        cache: "default", 
        credentials: "include", 
        headers: {
            "Content-Type": "application/json",
            "X-Origin": "client",
        },
    };

    window.createClass = async function () {
        const pick = document.getElementById("pickInput").value.trim();
        if (!pick) return;

        const user = "currentUserName"; // Replace with actual user fetching method
        const requestBody = { pick: pick, user: user };

        try {
            const res = await fetch(`${pythonURI}/api/class/add`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(requestBody),
                credentials: "include",
            });

            if (!res.ok) throw new Error("Failed to create class");
            const newClass = await res.json();
            displayClass(newClass);
            document.getElementById("pickInput").value = "";
        } catch (err) {
            console.error("Error:", err);
        }
    };

    window.updateMenu = async function (id) {
        const row = document.querySelector(`[data-id="${id}"]`);
        const pickCell = row.querySelector(".pick");
        const newPick = prompt("Enter new pick:", pickCell.textContent);
        if (!newPick) return;

        await fetch(`${pythonURI}/api/class/add`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id: id, pick: newPick }),
        });

        pickCell.textContent = newPick;
    };

    window.deleteClass = async function (id) {
        await fetch(`${pythonURI}/api/class/add`, {
            method: "DELETE",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id: id }),
        });

        document.querySelector(`[data-id="${id}"]`).remove();
    };

    window.displayClass = function (classData) {
        const tableBody = document.getElementById("classBody");
        const row = document.createElement("tr");
        row.setAttribute("data-id", classData.id);

        row.innerHTML = `
            <td>${classData.id}</td>
            <td class="pick">${classData.pick}</td>
            <td>${classData.user}</td>
            <td><button class="btn btn-update" onclick="updateMenu(${classData.id})">Update</button></td>
            <td><button class="btn btn-delete" onclick="deleteClass(${classData.id})">Delete</button></td>
        `;

        tableBody.appendChild(row);
    };

    fetch(`${pythonURI}/api/class/add`, fetchOptions)
        .then((res) => res.json())
        .then((classes) => classes.forEach(displayClass));
</script>
