---
layout: post
title: Classes
permalink: /classcrud/
menu: nav/home.html
search_exclude: true
show_reading_time: false
---

<style>
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: left;
    }
    th {
        background-color: #f4f4f4;
    }
    button {
        padding: 5px 10px;
        margin: 2px;
        border: none;
        cursor: pointer;
        border-radius: 4px;
    }
    .add-class-form {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }
    .update-input {
        display: none;
    }
    .update-input input {
        width: 80px;
    }
</style>

<table id="classTable">
    <thead>
        <tr>
            <th>ID</th>
            <th>Period</th>
            <th>Pick</th>
            <th>User</th>
            <th>Update</th>
            <th>Delete</th>
        </tr>
    </thead>
    <tbody id="classBody"></tbody>
</table>

<div class="add-class-form">
    <input type="text" id="classPick" placeholder="Enter class pick">
    <button onclick="createClass()" style="background-color: #28a745; color: white;">Add Class</button>
</div>

<script>
    var pythonURI = location.hostname.includes("localhost") || location.hostname === "127.0.0.1" 
        ? "http://localhost:8204" 
        : "https://neptune.stu.nighthawkcodingsociety.com";

    const fetchOptions = {
        method: "GET", 
        mode: "cors", 
        cache: "default", 
        credentials: "include", 
        headers: { "Content-Type": "application/json", "X-Origin": "client" },
    };

    window.createClass = async function () {
        const pick = document.getElementById("classPick").value;
        if (!pick) return;
        const user = "currentUserName"; 

        const requestBody = { pick, user };

        try {
            const res = await fetch(`${pythonURI}/api/class/add`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(requestBody),
                credentials: "include",
            });

            if (!res.ok) throw new Error("Failed to create class");

            const newClass = await res.json();
            displayClass(newClass);
            document.getElementById("classPick").value = "";
        } catch (err) {
            console.error("Error:", err);
        }
    };

    window.updateMenu = function (id) {
        const row = document.querySelector(`[data-id='${id}']`);
        const pickCell = row.querySelector(".pick");
        const inputField = row.querySelector(".update-input");
        const newPickInput = inputField.querySelector("input");
        inputField.style.display = "inline";
        newPickInput.focus();

        newPickInput.addEventListener("keypress", async function (event) {
            if (event.key === "Enter") {
                const newPick = newPickInput.value;
                if (!newPick) return;
                await fetch(`${pythonURI}/api/class/add`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ id, pick: newPick }),
                });
                pickCell.textContent = newPick;
                inputField.style.display = "none";
            }
        });
    };

    window.deleteClass = async function (id) {
        await fetch(`${pythonURI}/api/class/add`, {
            method: "DELETE",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id }),
        });
        document.querySelector(`[data-id='${id}']`).remove();
    };

    window.displayClass = function (classData) {  
        const tableBody = document.getElementById("classBody");
        const row = document.createElement("tr");
        row.setAttribute("data-id", classData.id);

        row.innerHTML = `
            <td>${classData.id}</td>
            <td>${classData.period}</td>
            <td class="pick">${classData.pick}</td>
            <td>${classData.user}</td>
            <td>
                <button onclick="updateMenu(${classData.id})" style="background-color: #ffc107;">Update</button>
                <span class="update-input">
                    <input type="text" placeholder="New pick">
                </span>
            </td>
            <td>
                <button onclick="deleteClass(${classData.id})" style="background-color: #dc3545; color: white;">Delete</button>
            </td>
        `;
        tableBody.appendChild(row);
    };

    fetch(`${pythonURI}/api/class/add`, fetchOptions)
        .then(res => res.json())
        .then(classes => classes.forEach(displayClass));
</script>
